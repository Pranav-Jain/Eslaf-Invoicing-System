<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="bootstrap.min.css" media="all"></link>
	<!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.99.0/css/materialize.min.css"> -->
	<style>
@media print
{    
    .print,.save, .print *
    {
        display: none !important;
    }
}
.row.display-flex {
  display: flex;
  flex-wrap: wrap;
}
.row.display-flex > [class*='col-'] {
  display: flex;
  flex-direction: column;
}
	 td{
		padding: 12px;
		text-align: left;
	}
	input {
    background: transparent;
    border: none;
}
table {
    table-layout: fixed;
    word-wrap: break-word;
    padding-top: 50;
    overflow: hidden;
}
hr{
	border-color: black;
  flex-grow: 1;
}
.currencyinput {
    background: transparent;
    border: none;
    font-size: 20px;
}
.currencyinput input {
    border: 0;
}
</style>
</head>
<body>
<script src="js/jquery.min.js"></script>
	<div class="container">
		<div class="row display-flex">
		<div class="col-xs-5">
		<h3 id="gstin"></h3>
		</div>
		<div class="col-xs-3">
		<h3 style="font-weight: bolder;"><u id="invoice">egrhtymumuymng</u></h3>
		</div>
		<div class="col-xs-4">
		<h3 align="right" style="margin-bottom: 5px"><u id="print"></u></h3>
		</div>
		</div>
		<div class="row">
			<div class="col-xs-12" style="border:1px solid black">
				<br>
				<img src="images/logo.png" style="float:left; width:250px; height:110px;"></img>
			<strong><p style="margin-bottom: -10px; margin-top: -20px;margin-left: 400px; font-size: 45px" id="company">J S TEXTILES</p></strong>
			<h3 style="margin-left: 300px" id="deals"></h3>
			<h4 id="address" style="margin-left: 400px">Address</h4>
			<h4 style="margin-left: 330px" id="phone"></h4>
		</div>
		</div>
		<div class="row display-flex">
		<div class="col-xs-6" style="border:1px solid black">
			<form>
			<br>
				<h3 style="display: inline;"><strong>Invoice No. : </strong>
				<h3 style="display: inline;margin-left: 2mm" class="form-group" type="text" size="20" id="invno"></h3>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				<h4 style="display: inline;">Date : <h4 id="DATE" style="display: inline;"></h4></h4></h3>
				<h4>E way bill no. : <input class="form-group" type="text" size="20" id="eway" disabled style="margin-left: 8mm"></input></h4>
				<h4 style="margin-top: -15px" id="rcharge">Reverse charge :</h4>
				<hr style="margin-top: 30px; margin-left: -16px; margin-right: -16px;border:solid 1px;">
				<h4 id="purord" style="margin-top: -8px">Purchase Order No.:</h4>
			</form>
		</div>
		<div class="col-xs-6" style="border:1px solid black">
			<form>
				<h4>Transport : 
				<input class="form-group" type="text" size="35" id="trans" disabled style="margin-left:17mm;"></input></h4>
				<h4>GR No. - Date :
				<input class="form-group" type="text" size="35" id="gr" disabled style="margin-left:7mm;"></input>
				</h4>
				<h4>Vehicle No. :
				<input class="form-group" type="text" size="35" id="vehicle" disabled style="margin-left:13mm;"></input>
				</h4>
				<h4>Place of supply : <input class="form-group" type="text" size="35" id="psupply" disabled style="margin-left:4mm;"></input></h4>
			</form>
	</div>
	</div>
	<div class="row display-flex">
		<div id="receiver" class="col-xs-6" style="border:1px solid black">
			<h3  style="border-bottom:1px solid black;margin: 0 auto;width: 64%"><center><strong>Details of Receiver (Billed to) : </strong></center></h3>
			<form>
				<h4>Name :
				<input class="form-group" type="text" id="bname" size="44" disabled style="margin-left:7mm;"></input></h4>
				<h4 style="float: left">Address :</h4><h4 style="margin-left: 90px; margin-top: 21px" id="badd"></h4>
				<br>
				<h4>GSTIN :<input class="form-group" type="text" size="20" id="cgstin" disabled style="margin-left: 7mm"></input>
				</h4>
				<h4 style="display: inline;float: left;" id="cstate">State :
				<h4 style="float: right;margin-right: 100px" id="ccode">Code :</h4></h4>
			</form>
		</div>
			<div class="col-xs-6" id="consignee" style="border:1px solid black">
			<h3 style="border-bottom:1px solid black;margin: 0 auto;width: 73%"><center><strong>Details of Consignee (Shipped to) : </strong></center></h3>
			<form>
				<h4>Name :
				<input class="form-group" type="text" id="sname" size="44" disabled style="margin-left:7mm;"></input></h4>
				<h4 style="float: left">Address :</h4><h4 style="margin-left: 90px; margin-top: 21px" id="sadd">TEST</h4>
				<br>
				<h4>GSTIN :<input class="form-group" type="text" size="20" id="sgstin" disabled style="margin-left: 7mm"></input>
				</h4>
				<h4 style="display: inline;float: left;" id="sstate">State :
				<h4 style="float: right;margin-right: 100px" id="scode">Code :</h4></h4>
			</form>
		</div>
		</div>
	<div class="row display-flex" id="table_goods">
	</div>
			<div class="row display-flex">
				<div class="col-xs-6" style="border:1px solid black">
					<h4 align="center" style="border-bottom: 1px solid black;padding-bottom:3px;" id="cin">CIN</h4>
					<h3 align="center" style="margin-top: -2px"><u>Bank Account Detail</u></h3>
					<h3 id="comp1" style="margin-top: -1px">TITLE: J S TEXTILES</h3>
					
					<h4 id="bank" style="margin-top: -3px">ICICI BANK, TILAK NAGAR BRANCH, NEW DELHI</h4>
					
					<h4 id="ac" style="margin-top: -3px">A/C NO. : 10050500169 / IFSC CODE : ICIC0001005</h4>

				</div>
				<div class="col-xs-4" style="border:1px solid black">
					<h4 align="center" style="border-bottom: 1px solid;padding-bottom: 3px">FREIGHT CHARGES</h4>
					<h4 align="center" style="border-bottom: 1px solid;">TAXABLE AMOUNT</h4>
					<h4 id="cgst" class="cgst" align="center" style="border-bottom: 1px solid;">CGST @&nbsp%</h4>
					<h4 id="sgst" class="sgst" align="center" style="border-bottom: 1px solid;">SGST @&nbsp%</h4>
					<h4 align="center" class="igst" id="igst" style="margin-bottom: -1px">SGST @&nbsp%</h4>
				</div>
				<div class="col-xs-2" style="border:1px solid black">
				<p align="right" id="freight" style="border-bottom: 1px solid;font-size: 17px;padding-top: 8px"></p>
					<h4 align="right" id="total" style="border-bottom: 1px solid;"></h4>
					<h4 class="cgst" id="cg" align="right" style="border-bottom: 1px solid;">something</h4>
					<h4 class="sgst" id="sg" align="right" style="border-bottom: 1px solid;">something</h4>
					<h4><div class="igst" id="ig" align="right"></div></h4>
				</div>
			</div>
				<div class="row display-flex">
				<div class="col-xs-6" style="border:1px solid black">
					<h4><b>Total invoice amount (in words) :</b></h4>
					<h4 style="margin-top: -5px"><div id="words"></div></h4>
				</div>
				<div class="col-xs-4" style="border:1px solid black">
					<h4 align="center" style="border-bottom: 1px solid;">Rounded off:</h4>
					<h3 align="center"><b>INVOICE TOTAL</b></h3>
				</div>
				<div class="col-xs-2" style="border:1px solid black">
					<h4 align="right"><div id="roundoff"  style="border-bottom: 1px solid;"></div></h4>
					<h3 align="right"><strong><div id="invtotal"></div></strong></h3>
				</div>
			</div>
				<div class="row">
				<div class="col-xs-6" style="border:1px solid black">
					<h4>E. & O. E.</h4>
					<h5>TERMS AND CONDITIONS</h5>
					<h5>
						<ul>
							<li>Interest will be charged @ 12% p.a if bill is not paid within 7 days.</li>
							<li>Our risk and responsibilty ceases after delivery of goods to transporter.</li>
							<li>Disputes if any, Subject to Delhi Jurisdiction only.</li>
						</ul>
					</h5>
					<br>
				</div>
				<!-- <div class="row">
				<div class="col-lg-5" style="border:1px solid black"> -->
				<div class="col-xs-6" style="border:1px solid black">
					<h5><center>Certified that the particulars given above are true	and correct</center></h5>
					<h4 align="right" id="comp2">For JS Textiles</h4>
					<br><br>
					<h5 align="right">Authorised Signatory</h5>
				</div>
			</div>
	</div>
	</div>
	<!-- </div>
	</div> -->
	<center><h4 class="save"><button onclick="save()" style="" id="save">Save</button></h4>
	<div class="container">
	<div class="row">
	<div class="col-xs-4">
	<h4 class="print"><button onclick="print1()" style="" disabled id="print1">Print Original</button></h4>
	</div>
	<div class="col-xs-4">
	<h4 class="print"><button onclick="print2()" style="" disabled id="print2">Print Duplicate</button></h4>
	</div>
	<div class="col-xs-4">
	<h4 class="print"><button onclick="print3()" style="" disabled id="print3">Print Triplicate</button></h4>
	</div>
	</div>
	</div>

</body>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>
function totext(){
	var html = "<input id='invoice' type='textbox' value="
               + $("#invoice option:selected").val() +" />";
   $("#invoice").remove();
   $("#Invoice").append(html);}
</script>

<script type="text/javascript">
var total = 0;
var invtotal = 0;
	window.onload = function () {
    var url = document.location.href,
        params = url.split('?')[1].split('&'),
        data = {}, tmp;
    for (var i = 0, l = params.length; i < l; i++) {
         tmp = params[i].split('=');
         data[tmp[0]] = tmp[1];
    }
    data.address = data.address.replace(/ AND /g, " & ")
    data.deals = data.deals.replace(/ AND /g, " & ");
    data.cname = data.cname.replace(/ AND /g, " & ");
    data.bname = data.bname.replace(/ AND /g, " & ");
    data.badd = data.badd.replace(/ AND /g, " & ");
    data.sadd = data.sadd.replace(/ AND /g, " & ");

    if(decodeURIComponent(data.invoice)=="RCM INVOICE"){
    	data.badd = data.address;
    	data.cstate = "DELHI";
    	data.cgstin = data.gstin;
    	data.sname = data.company;
    	data.sadd = data.address;
    	data.sgstin = data.gstin;
    	data.sstate = "DELHI";
    	data.cname = data.company;
    }
    var colour = "#B31B11";
    if(decodeURIComponent(data.company).toLowerCase().trim()=="j s textiles")
    	colour="#0D23C0";
    else if(decodeURIComponent(data.company).toLowerCase().trim()=="lamode intimates")
    	colour="#11B336";

    document.getElementById('invoice').innerHTML = decodeURIComponent(data.invoice);
    document.getElementById('gstin').innerHTML = "GSTIN : " + decodeURIComponent(data.gstin);
    document.getElementById('company').innerHTML = decodeURIComponent(data.company);
    document.getElementById("company").style.color = colour;
    document.getElementById('address').innerHTML = decodeURIComponent(data.address);
    document.getElementById('phone').innerHTML = "Tel : " + decodeURIComponent(data.phone) + "; E-mail : " + decodeURIComponent(data.email);
    document.getElementById('deals').innerHTML = decodeURIComponent(data.deals);
    document.getElementById('freight').innerHTML = "&#x20b9;  "+parseFloat(data.freight).toFixed(2);
 //    document.getElementById('pan').innerHTML = decodeURIComponent(data.pan);
    document.getElementById('bank').innerHTML = decodeURIComponent(data.bank);
    document.getElementById('ac').innerHTML = "A/C No : " + decodeURIComponent(data.ac)+"&nbsp&nbsp&nbsp,&nbsp&nbsp&nbsp"+"IFSC CODE: "+decodeURIComponent(data.ifsc);
    document.getElementById('comp1').innerHTML = "TITLE : " + decodeURIComponent(data.company);
    document.getElementById('comp2').innerHTML = "FOR : " + decodeURIComponent(data.company);
    document.getElementById('DATE').innerHTML = decodeURIComponent(data.date);
    document.getElementById('invno').innerHTML = decodeURIComponent(data.invno);
    document.getElementById("invno").style.color = colour;
    document.getElementById('eway').value = decodeURIComponent(data.eway).toUpperCase();
    document.getElementById('purord').innerHTML = "Purchase Order No.: "+decodeURIComponent(data.purord).toUpperCase();
    document.getElementById('trans').value = decodeURIComponent(data.trans).toUpperCase();
    document.getElementById('gr').value = decodeURIComponent(data.gr).toUpperCase();
    document.getElementById('vehicle').value = decodeURIComponent(data.vehicle).toUpperCase();
    document.getElementById('psupply').value = decodeURIComponent(data.psupply).toUpperCase();
    document.getElementById('bname').value = decodeURIComponent(data.bname);
    document.getElementById('sname').value = decodeURIComponent(data.sname);
    document.getElementById('badd').innerHTML = decodeURIComponent(data.badd);
    document.getElementById('sadd').innerHTML = decodeURIComponent(data.sadd);
    document.getElementById('cgstin').value = decodeURIComponent(data.cgstin);
    document.getElementById('sgstin').value = decodeURIComponent(data.sgstin);
    document.getElementById('cstate').innerHTML = "State: <div style='margin-left:9mm;display:inline'>"+decodeURIComponent(data.cstate)+"</div>";
    document.getElementById('sstate').innerHTML = "State: <div style='margin-left:9mm;display:inline'>"+decodeURIComponent(data.sstate)+"</div>";
    document.getElementById('ccode').innerHTML= "Code: " + decodeURIComponent(data.cgstin.substr(0,2));
     document.getElementById('scode').innerHTML= "Code: " + decodeURIComponent(data.sgstin.substr(0,2));
    if(decodeURIComponent(data.invoice)=="RCM INVOICE")
    	document.getElementById('rcharge').innerHTML= 'Reverse Charge:  <div style="margin-left:5mm; display:inline">Yes</div>';
    else
    	document.getElementById('rcharge').innerHTML= "Reverse Charge:  <div style='margin-left:4mm; display:inline'>NO</div>";
    if(data.cin!="undefined")
    	document.getElementById('cin').innerHTML = "CIN No.: "+decodeURIComponent(data.cin);
    else
    	document.getElementById('cin').innerHTML = "PAN No.: "+decodeURIComponent(data.pan);
    
    var items = new Array();
    items = decodeURIComponent(data.items).split(',');
    var hsn = new Array();
    hsn = decodeURIComponent(data.hsn).split(',');
    var gst = data.gst;
    var qty = new Array();
    qty = decodeURIComponent(data.qty).split(',');
    var rate = new Array();
    rate = decodeURIComponent(data.rate).split(',');
    $( "#table_goods" ).append( `<table style="border:1px;border-style: solid;border-color: black;border-collapse:separate;margin-top:-1px">
    		<tr>
				<td style="font-size:20px; border:solid 1px black;text-align:center; padding:12px;min-width:77px;"><b>S.No.</b></td>
				<td style="font-size:20px;border:1px solid black;text-align:center; padding:12px;min-width:506px;max-width:508px"><b>DESCRIPTION OF GOODS</b></td>
				<td style="font-size:20px;border:1px solid black;text-align:center; padding:12px;min-width:135px"><b>HSN CODE</b></td>
				<td style="font-size:20px;border:1px solid black;text-align:center; padding:12px;min-width:128px"><b>QUANTITY</b></td>
				<td style="font-size:20px;border:1px solid black;text-align:center; padding:12px;min-width:127px"><b>RATE</b></td>
			    <td style="font-size:20px;border:1px solid black;text-align:center; padding:12px;min-width:193px;"><b>AMOUNT (in Rs.)</b></td></tr>`);
    var r =10-items.length;
   	for(i=2;i<=items.length;i++){
   		items[i-1] = items[i-1].replace(/ AND /g, " & ");
   		items[i-1] = items[i-1].replace(/ and /g, " & ");
   	$( "#table_goods" ).append(`<tr>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:78px; border-bottom:none">
				<center>`+ eval(i-1) + `</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:left;min-width:506px;max-width:508px; border-bottom:none">
				`+ items[i-1] + `
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:135px; border-bottom:none">
				<center>`+ hsn[i-2] +`</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:129px; border-bottom:none">
				<center>`+qty[i-1]+`</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:127px;">
				<center>`+addZeroes(String(rate[i-1]))+`</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;border-right:1px solid black;text-align:right;min-width:195px; border-bottom:none">
				`+parseFloat(eval(qty[i-1]*rate[i-1])).toFixed(2)+`
				</td>`);
   	total += eval(qty[i-1]*rate[i-1]); 
}
for(i=1;i<=r;i++)
{
	$( "#table_goods" ).append(`<tr>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:78px; border-bottom:none;">
				<center style="visibility:hidden">test</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:left;min-width:506px; border-bottom:none">
				<center style="visibility:hidden">test</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:135px; border-bottom:none">
				<center style="visibility:hidden">test</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:129px; border-bottom:none">
				<center style="visibility:hidden">test</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;text-align:center;min-width:127px;">
				<center style="visibility:hidden">test</center>
				</td>
				<td style="font-size:20px; border-left:1px solid black;border-right:1px solid black;text-align:right;min-width:195px; border-bottom:none">
				<center style="visibility:hidden">test</center>
				</td>`);
}
	total+=parseInt(data.freight);
	document.getElementById('total').innerHTML= "&#x20b9;  "+parseFloat(total).toFixed(2);
	if(String(data.cgstin.substr(0,2))===("07"))
    {
    	document.getElementById('cgst').innerHTML="CGST @&nbsp " + parseFloat(eval(gst/2)) + " %";
    	document.getElementById('sgst').innerHTML="SGST @&nbsp " + parseFloat(gst/2) + " %";
    	$('.igst').remove();
    	var diff = (Math.ceil(total + gst/100*total) - (total + gst/100*total)).toFixed(2);
    	document.getElementById('roundoff').innerHTML =  "&#x20b9;  "+parseFloat(diff).toFixed(2);
    	invtotal = Math.ceil(total + gst/100*total);
    	document.getElementById('cg').innerHTML = "&#x20b9;  "+eval(gst/200*total).toFixed(2);
    	document.getElementById('sg').innerHTML = "&#x20b9;  "+eval(gst/200*total).toFixed(2);
    	document.getElementById('invtotal').innerHTML = "&#x20b9;  "+parseFloat(invtotal).toFixed(2);
    }
    else
    {
    	document.getElementById('igst').innerHTML="IGST @&nbsp " + gst + " %";
    	$('.cgst').remove();
    	$('.sgst').remove();
    	var diff = (Math.ceil(total + gst/100*total) - (total + gst/100*total)).toFixed(2);
    	document.getElementById('roundoff').innerHTML =  "&#x20b9;  "+parseFloat(diff).toFixed(2);
    	invtotal = Math.ceil(total + gst/100*total);
    	document.getElementById('ig').innerHTML = "&#x20b9;  "+eval(gst/100*total).toFixed(2);
    	document.getElementById('invtotal').innerHTML = "&#x20b9;  "+parseFloat(invtotal).toFixed(2);
    }
    document.getElementById("words").innerHTML = "Rs. "+convertNumberToWords(invtotal) + " only.";
}

</script>

<script type="text/javascript">
function convertNumberToWords(amount) {
    var words = new Array();
    words[0] = '';
    words[1] = 'One';
    words[2] = 'Two';
    words[3] = 'Three';
    words[4] = 'Four';
    words[5] = 'Five';
    words[6] = 'Six';
    words[7] = 'Seven';
    words[8] = 'Eight';
    words[9] = 'Nine';
    words[10] = 'Ten';
    words[11] = 'Eleven';
    words[12] = 'Twelve';
    words[13] = 'Thirteen';
    words[14] = 'Fourteen';
    words[15] = 'Fifteen';
    words[16] = 'Sixteen';
    words[17] = 'Seventeen';
    words[18] = 'Eighteen';
    words[19] = 'Nineteen';
    words[20] = 'Twenty';
    words[30] = 'Thirty';
    words[40] = 'Forty';
    words[50] = 'Fifty';
    words[60] = 'Sixty';
    words[70] = 'Seventy';
    words[80] = 'Eighty';
    words[90] = 'Ninety';
    amount = amount.toString();
    var atemp = amount.split(".");
    var number = atemp[0].split(",").join("");
    var n_length = number.length;
    var words_string = "";
    if (n_length <= 9) {
        var n_array = new Array(0, 0, 0, 0, 0, 0, 0, 0, 0);
        var received_n_array = new Array();
        for (var i = 0; i < n_length; i++) {
            received_n_array[i] = number.substr(i, 1);
        }
        for (var i = 9 - n_length, j = 0; i < 9; i++, j++) {
            n_array[i] = received_n_array[j];
        }
        for (var i = 0, j = 1; i < 9; i++, j++) {
            if (i == 0 || i == 2 || i == 4 || i == 7) {
                if (n_array[i] == 1) {
                    n_array[j] = 10 + parseInt(n_array[j]);
                    n_array[i] = 0;
                }
            }
        }
        value = "";
        for (var i = 0; i < 9; i++) {
            if (i == 0 || i == 2 || i == 4 || i == 7) {
                value = n_array[i] * 10;
            } else {
                value = n_array[i];
            }
            if (value != 0) {
                words_string += words[value] + " ";
            }
            if ((i == 1 && value != 0) || (i == 0 && value != 0 && n_array[i + 1] == 0)) {
                words_string += "Crores ";
            }
            if ((i == 3 && value != 0) || (i == 2 && value != 0 && n_array[i + 1] == 0)) {
                words_string += "Lakhs ";
            }
            if ((i == 5 && value != 0) || (i == 4 && value != 0 && n_array[i + 1] == 0)) {
                words_string += "Thousand ";
            }
            if (i == 6 && value != 0 && (n_array[i + 1] != 0 && n_array[i + 2] != 0)) {
                words_string += "Hundred and ";
            } else if (i == 6 && value != 0) {
                words_string += "Hundred ";
            }
        }
        words_string = words_string.split("  ").join(" ");
    }
    return words_string;
}
</script>
<script type="text/javascript">
	function print1(){
		document.getElementById("print").innerHTML="Original for Buyer";
		window.print();
		return false;
	}
	function print2(){
		document.getElementById("print").innerHTML="Duplicate for Transporter/Receiver";
		window.print();
	}
	function print3(){
		document.getElementById("print").innerHTML="Triplicate for Seller";
		window.print();
	}
	function save(){
		$('#save').attr('disabled', 'disabled');
		$('#print1').removeAttr('disabled');
		$('#print2').removeAttr('disabled');
		$('#print3').removeAttr('disabled');
		var url = document.location.href,
        params = url.split('?')[1].split('&'),
        data = {}, tmp;
    for (var i = 0, l = params.length; i < l; i++) {
         tmp = params[i].split('=');
         data[tmp[0]] = tmp[1];
    }

    	if(String(decodeURIComponent(data.cgstin)).length==2){
    		document.getElementById('cgstin').value = "";
    		document.getElementById('sgstin').value = "";
    	}
		var flag =1;
		$.ajax({
	    	type: "POST",
		    url: "/getinvoice",
		    contentType: "application/json; charset=utf-8",
		    // dataType: "json",
		    data: JSON.stringify({ invoice: decodeURIComponent(data.invoice), company:decodeURIComponent(data.company) }),
		    success: function (response) {
		    //alert(response);
	        if(parseInt(response)>parseInt(decodeURIComponent(data.invno))){
	        	alert("Bill already created");
	        	alert("Closing the current window");
	        	flag=0;
	        	window.close();
	        }
	        else{
			    	data.bname = data.bname.replace(/ AND /g, " & ");
			    	var pending ='0';
			    	if(data.gr=='' || data.trans=='')
			    		pending='1';
					$.ajax({
			    	type: "POST",
				    url: "/updateinvoice",
				    contentType: "application/json; charset=utf-8",
				    // dataType: "json",
				    data: JSON.stringify({ invoice: decodeURIComponent(data.invoice), company:decodeURIComponent(data.company) }),
				    success: function (response) {
			        },
					});
					$.ajax({
			        type: "POST",
			        url: "/puturl",
			        contentType: "application/json; charset=utf-8",
			        // dataType: "json",
			        data: JSON.stringify({ date:  decodeURIComponent(data.date), invoice: decodeURIComponent(data.invno), company: decodeURIComponent(data.company), customer: decodeURIComponent(data.bname), url:String(url), pending:pending }),
			        success: function (response) {
			        },
			        });
					alert("Saved");
	        	}
	        },
			});
	}

	function addZeroes( num ) {
    var value = Number(num);
    var res = num.split(".");
    if(num.indexOf('.') === -1) {
        value = value.toFixed(2);
        num = value.toString();
    } else if (res[1].length < 3) {
        value = value.toFixed(2);
        num = value.toString();
    }
return num
}

</script>
</html>